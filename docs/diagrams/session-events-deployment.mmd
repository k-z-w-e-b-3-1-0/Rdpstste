graph LR
    subgraph MonitoredEndpoint["監視対象端末\n(Windows クライアント)"]
        TaskScheduler["タスク スケジューラ"]
        Notify["session_notify\n(.ps1 / .bat)"]
        SessionEnd["session_end_event\n(.ps1 / .bat)"]
    end

    subgraph OperatorDevice["オペレーター端末"]
        Browser["Web ブラウザ\n(ダッシュボード)"]
    end

    subgraph MonitoringServer["Rdpstste 監視サーバ"]
        API["REST API\n(server.js)"]
        Store["sessions.json ストア"]
        Dashboard["ダッシュボード UI\n(public/ 配信)"]
        Slack["Slack Webhook\n(任意)"]
    end

    TaskScheduler -- "ログオン / 接続検知時" --> Notify
    TaskScheduler -- "ログオフ / 切断検知時" --> SessionEnd
    Notify -- "POST /api/sessions/auto-heartbeat" --> API
    SessionEnd -- "POST /api/sessions/end" --> API
    Browser -- "PUT /api/sessions/{id}\n(status=disconnected)" --> API
    Browser -- "GET /api/sessions" --> API
    API -- "イベントを保存" --> Store
    API -- "一覧データ" --> Dashboard
    Dashboard -- "HTML/JS 配信" --> Browser
    API -- "接続/終了通知" --> Slack
    API -- "最新セッション情報" --> Notify
    API -- "更新結果" --> Browser

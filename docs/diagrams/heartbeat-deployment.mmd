graph LR
    subgraph MonitoringServer["監視サーバ\n(Event Collector)"]
        Collector["イベント Collector"]
        Store["セッション状態ストア"]
    end

    subgraph Monitored_Node_A["監視対象ノード A\n(Windows + イベントスクリプト)"]
        LogonA["ログオン トリガー"]
        RemoteA["リモート接続検知"]
        NotifyA["session_notify\n(.ps1 / .bat)"]
        EndA["session_end_event\n(.ps1 / .bat)"]
    end

    subgraph Monitored_Node_B["監視対象ノード B\n(Windows + イベントスクリプト)"]
        LogonB["ログオン トリガー"]
        RemoteB["リモート接続検知"]
        NotifyB["session_notify\n(.ps1 / .bat)"]
        EndB["session_end_event\n(.ps1 / .bat)"]
    end

    LogonA -- "ログオン / 接続確立" --> NotifyA
    RemoteA -- "RDP セッション確立" --> NotifyA
    NotifyA -- "session.notify\nPOST /api/sessions/auto-heartbeat" --> Collector
    EndA -- "session.end\nPOST /api/sessions/end" --> Collector

    LogonB -- "ログオン / 接続確立" --> NotifyB
    RemoteB -- "RDP セッション確立" --> NotifyB
    NotifyB -- "session.notify\nPOST /api/sessions/auto-heartbeat" --> Collector
    EndB -- "session.end\nPOST /api/sessions/end" --> Collector

    Collector -- "状態更新" --> Store

sequenceDiagram
    participant Client as 監視対象端末
    participant NotifyAgent as session_notify(.ps1/.bat)
    participant EndAgent as session_end_event(.ps1/.bat)
    participant Api as Rdpstste REST API
    participant Store as sessions.json ストア
    participant Operator as 管理者
    participant Browser as Web ブラウザ
    participant Slack as Slack Webhook(任意)

    rect rgb(250,245,232)
        note over NotifyAgent,Api: セッション通知イベント
        Client->>NotifyAgent: ログオン / リモート接続検知
        NotifyAgent->>Api: POST /api/sessions/auto-heartbeat<br/>session.notify ペイロード送信
        Api->>Store: セッションを作成 or 更新 (status=connected)
        Api-->>NotifyAgent: 200 OK (セッション情報)
        Api-->>Slack: 接続通知 (任意)
    end

    rect rgb(255,244,240)
        note over Operator,Browser: 手動ステータス更新
        Operator->>Browser: 「切断に変更」をクリック
        Browser->>Api: PUT /api/sessions/{id}<br/>status=disconnected
        Api->>Store: ステータスを更新
        Api-->>Browser: 200 OK (更新済セッション)
    end

    rect rgb(255,240,240)
        note over EndAgent,Api: セッション終了イベント
        Client->>EndAgent: ログオフ / セッション切断トリガー
        EndAgent->>Api: POST /api/sessions/end<br/>session.end ペイロード送信
        Api->>Store: 終了ログを追記 / status=disconnected
        Api-->>EndAgent: 200 OK
        Api-->>Slack: 終了通知 (任意)
    end

    Note over Browser,Api: ダッシュボードは30秒ごとに<br/>GET /api/sessions で最新状態を取得

sequenceDiagram
    participant Client as 監視対象端末
    participant Agent as session_notify(.ps1/.bat)
    participant Api as Rdpstste REST API
    participant Store as sessions.json ストア
    participant Operator as 管理者
    participant Browser as Web ブラウザ
    participant Slack as Slack Webhook(任意)

    rect rgb(232,245,255)
        note over Agent,Api: 接続イベント
        Client->>Agent: ログオン / 初回タスク起動
        Agent->>Api: POST /api/sessions/auto-heartbeat<br/>接続メタデータ送信
        Api->>Store: セッション登録 / status=connected
        Api-->>Agent: 200 OK (セッション情報)
        Api-->>Slack: 接続通知 (新規 or 状態遷移時)
    end

    rect rgb(240,255,240)
        note over Agent,Api: ハートビートイベント
        loop 5分毎
            Agent->>Api: POST /api/sessions/auto-heartbeat<br/>lastSeen・プロセス状態更新
            Api->>Store: lastSeen を更新
            Api-->>Agent: 200 OK
        end
    end

    rect rgb(255,244,240)
        note over Operator,Browser: 切断イベント
        Operator->>Browser: 「切断に変更」をクリック
        Browser->>Api: PUT /api/sessions/{id}<br/>status=disconnected
        Api->>Store: ステータスを更新
        Api-->>Browser: 200 OK (更新済セッション)
    end

    Note over Browser,Api: ダッシュボードは30秒ごとに<br/>GET /api/sessions で最新状態を取得
